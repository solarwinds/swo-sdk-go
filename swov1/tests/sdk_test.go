// Code generated by Speakeasy (https://speakeasy.com). DO NOT EDIT.

package tests

import (
	"context"
	"github.com/solarwinds/swo-sdk-go/swov1"
	"github.com/solarwinds/swo-sdk-go/swov1/internal/utils"
	"github.com/solarwinds/swo-sdk-go/swov1/models/components"
	"github.com/solarwinds/swo-sdk-go/swov1/models/operations"
	"github.com/solarwinds/swo-sdk-go/swov1/types"
	"github.com/stretchr/testify/assert"
	"github.com/stretchr/testify/require"
	"testing"
)

func TestSDK_ChangeEvents(t *testing.T) {
	ctx := context.Background()

	testHTTPClient := createTestHTTPClient("changeEvents")

	s := swov1.New(
		swov1.WithServerURL(utils.GetEnv("PUBLIC_SWO_API_STAGE_URL", "")),
		swov1.WithSecurity(utils.GetEnv("SWO_STAGE_API_TOKEN", "value")),
		swov1.WithClient(testHTTPClient),
	)

	createRes, err := s.ChangeEvents.CreateChangeEvent(ctx, components.ChangeEventsChangeEvent{
		Name:        "swo-sdk-e2e-test-event",
		Title:       "SWO SDK E2E Test Deployment",
		Source:      swov1.String("swo-sdk-go-test"),
		Description: swov1.String("End-to-end test deployment event created by SWO SDK"),
		Tags: map[string]string{
			"environment": "test",
			"service":     "swo-sdk",
			"version":     "1.0.0",
		},
	})
	require.NoError(t, err)
	assert.Equal(t, 202, createRes.HTTPMeta.Response.StatusCode)

}

func TestSDK_CompositeMetricsCrudLifecycle(t *testing.T) {
	ctx := context.Background()

	testHTTPClient := createTestHTTPClient("compositeMetricsCrudLifecycle")

	s := swov1.New(
		swov1.WithServerURL(utils.GetEnv("PUBLIC_SWO_API_STAGE_URL", "")),
		swov1.WithSecurity(utils.GetEnv("SWO_STAGE_API_TOKEN", "value")),
		swov1.WithClient(testHTTPClient),
	)

	createRes, err := s.Metrics.CreateCompositeMetric(ctx, components.MetricsCompositeMetric{
		Name:        "composite.swo.sdk.e2e.create.metric.test",
		DisplayName: swov1.String("SWO SDK E2E Create Metric Test"),
		Description: swov1.String("SWO SDK composite metric end to end create test"),
		Formula:     "rate(system.disk.io[1m])",
		Units:       swov1.String("bytes/s"),
	})
	require.NoError(t, err)
	assert.Equal(t, 201, createRes.HTTPMeta.Response.StatusCode)
	assert.Equal(t, "composite.swo.sdk.e2e.create.metric.test", createRes.MetricsCompositeMetric.Name)
	assert.NotNil(t, createRes.MetricsCompositeMetric.DisplayName)
	assert.Equal(t, swov1.String("SWO SDK E2E Create Metric Test"), createRes.MetricsCompositeMetric.DisplayName)
	assert.NotNil(t, createRes.MetricsCompositeMetric.Description)
	assert.Equal(t, swov1.String("SWO SDK composite metric end to end create test"), createRes.MetricsCompositeMetric.Description)
	assert.Equal(t, "rate(system.disk.io[1m])", createRes.MetricsCompositeMetric.Formula)
	assert.NotNil(t, createRes.MetricsCompositeMetric.Units)
	assert.Equal(t, swov1.String("bytes/s"), createRes.MetricsCompositeMetric.Units)

	getByNameRes, err := s.Metrics.GetMetricByName(ctx, operations.GetMetricByNameRequest{
		Name: createRes.MetricsCompositeMetric.Name,
	})
	require.NoError(t, err)
	assert.Equal(t, 200, getByNameRes.HTTPMeta.Response.StatusCode)
	assert.Equal(t, "composite.swo.sdk.e2e.create.metric.test", getByNameRes.CommonMetricInfo.Name)
	assert.NotNil(t, getByNameRes.CommonMetricInfo.DisplayName)
	assert.Equal(t, swov1.String("SWO SDK E2E Create Metric Test"), getByNameRes.CommonMetricInfo.DisplayName)
	assert.NotNil(t, getByNameRes.CommonMetricInfo.Description)
	assert.Equal(t, swov1.String("SWO SDK composite metric end to end create test"), getByNameRes.CommonMetricInfo.Description)
	assert.NotNil(t, getByNameRes.CommonMetricInfo.Formula)
	assert.Equal(t, swov1.String("rate(system.disk.io[1m])"), getByNameRes.CommonMetricInfo.Formula)
	assert.NotNil(t, getByNameRes.CommonMetricInfo.Units)
	assert.Equal(t, swov1.String("bytes/s"), getByNameRes.CommonMetricInfo.Units)

	updateRes, err := s.Metrics.UpdateCompositeMetric(ctx, operations.UpdateCompositeMetricRequest{
		Name: createRes.MetricsCompositeMetric.Name,
		MetricsUpdateCompositeMetricRequest: components.MetricsUpdateCompositeMetricRequest{
			DisplayName: swov1.String("SWO SDK E2E Updated Metric Test"),
			Description: swov1.String("SWO SDK composite metric end to end updated test"),
			Formula:     "rate(system.cpu.usage[2m])",
			Units:       swov1.String("bytes/s"),
		},
	})
	require.NoError(t, err)
	assert.Equal(t, 200, updateRes.HTTPMeta.Response.StatusCode)
	assert.Equal(t, "composite.swo.sdk.e2e.create.metric.test", updateRes.MetricsCompositeMetric.Name)
	assert.NotNil(t, updateRes.MetricsCompositeMetric.DisplayName)
	assert.Equal(t, swov1.String("SWO SDK E2E Updated Metric Test"), updateRes.MetricsCompositeMetric.DisplayName)
	assert.NotNil(t, updateRes.MetricsCompositeMetric.Description)
	assert.Equal(t, swov1.String("SWO SDK composite metric end to end updated test"), updateRes.MetricsCompositeMetric.Description)
	assert.Equal(t, "rate(system.cpu.usage[2m])", updateRes.MetricsCompositeMetric.Formula)
	assert.NotNil(t, updateRes.MetricsCompositeMetric.Units)
	assert.Equal(t, swov1.String("bytes/s"), updateRes.MetricsCompositeMetric.Units)

	getUpdatedMetricRes, err := s.Metrics.GetMetricByName(ctx, operations.GetMetricByNameRequest{
		Name: createRes.MetricsCompositeMetric.Name,
	})
	require.NoError(t, err)
	assert.Equal(t, 200, getUpdatedMetricRes.HTTPMeta.Response.StatusCode)
	assert.Equal(t, "composite.swo.sdk.e2e.create.metric.test", getUpdatedMetricRes.CommonMetricInfo.Name)
	assert.NotNil(t, getUpdatedMetricRes.CommonMetricInfo.DisplayName)
	assert.Equal(t, swov1.String("SWO SDK E2E Updated Metric Test"), getUpdatedMetricRes.CommonMetricInfo.DisplayName)
	assert.NotNil(t, getUpdatedMetricRes.CommonMetricInfo.Description)
	assert.Equal(t, swov1.String("SWO SDK composite metric end to end updated test"), getUpdatedMetricRes.CommonMetricInfo.Description)
	assert.NotNil(t, getUpdatedMetricRes.CommonMetricInfo.Formula)
	assert.Equal(t, swov1.String("rate(system.cpu.usage[2m])"), getUpdatedMetricRes.CommonMetricInfo.Formula)
	assert.NotNil(t, getUpdatedMetricRes.CommonMetricInfo.Units)
	assert.Equal(t, swov1.String("bytes/s"), getUpdatedMetricRes.CommonMetricInfo.Units)

	deleteRes, err := s.Metrics.DeleteCompositeMetric(ctx, operations.DeleteCompositeMetricRequest{
		Name: createRes.MetricsCompositeMetric.Name,
	})
	require.NoError(t, err)
	assert.Equal(t, 204, deleteRes.HTTPMeta.Response.StatusCode)

}

func TestSDK_LogsSearch(t *testing.T) {
	ctx := context.Background()

	testHTTPClient := createTestHTTPClient("logsSearch")

	s := swov1.New(
		swov1.WithServerURL(utils.GetEnv("PUBLIC_SWO_API_STAGE_URL", "")),
		swov1.WithSecurity(utils.GetEnv("SWO_STAGE_API_TOKEN", "value")),
		swov1.WithClient(testHTTPClient),
	)

	searchRes, err := s.Logs.SearchLogs(ctx, operations.SearchLogsRequest{
		Filter:    swov1.String("level:info"),
		StartTime: types.MustNewTimeFromString("2025-06-15T00:00:00Z"),
		EndTime:   types.MustNewTimeFromString("2025-07-22T23:59:59Z"),
		PageSize:  swov1.Int(10),
	})
	require.NoError(t, err)
	assert.Equal(t, 200, searchRes.HTTPMeta.Response.StatusCode)

}

func TestSDK_LogsArchives(t *testing.T) {
	ctx := context.Background()

	testHTTPClient := createTestHTTPClient("logsArchives")

	s := swov1.New(
		swov1.WithServerURL(utils.GetEnv("PUBLIC_SWO_API_STAGE_URL", "")),
		swov1.WithSecurity(utils.GetEnv("SWO_STAGE_API_TOKEN", "value")),
		swov1.WithClient(testHTTPClient),
	)

	listRes, err := s.Logs.ListLogArchives(ctx, operations.ListLogArchivesRequest{
		StartTime: "2025-06-15T00:00:00Z",
		EndTime:   "2025-07-22T23:59:59Z",
		PageSize:  swov1.Int(10),
	})
	require.NoError(t, err)
	assert.Equal(t, 200, listRes.HTTPMeta.Response.StatusCode)

}

func TestSDK_Tokens(t *testing.T) {
	t.Skip("incomplete test found please make sure to address the following errors: [`workflow step tokens.create referencing operation createToken does not contain response with status code 200`]")
}
