arazzo: 1.0.1
info:
  title: SWO End-to-End CRUD Contract Tests
  summary: Contract tests that run against the SWO Public API
  version: 0.0.1
sourceDescriptions:
  - name: public-api
    url: https://api.na-01.cloud.solarwinds.com/v1/openapi.json
    type: openapi
x-speakeasy-test-server:
  baseUrl: "x-env: PUBLIC_SWO_API_STAGE_URL"
x-speakeasy-test-security:
  value:
    ApiToken: "x-env: SWO_STAGE_API_TOKEN"
workflows:
  # /v1/changeevents - Create change event operation
  - workflowId: changeEvents
    steps:
      - stepId: create
        description: Create a new change event
        operationId: createChangeEvent
        requestBody:
          contentType: application/json
          payload: {"name": "swo-sdk-e2e-test-event", "title": "SWO SDK E2E Test Deployment", "source": "swo-sdk-go-test", "description": "End-to-end test deployment event created by SWO SDK", "tags": {"environment": "test", "service": "swo-sdk", "version": "1.0.0"}}
        successCriteria:
          - condition: $statusCode == 202
          - condition: $response.header.Content-Type == application/json
          - condition: $response.body#/id != null
        outputs:
          eventId: $response.body#/id
  # /v1/metrics - Composite metrics CRUD operations
  - workflowId: compositeMetricsCrudLifecycle
    steps:
      - stepId: create
        operationId: createCompositeMetric
        requestBody:
          contentType: application/json
          payload: {"name": "composite.swo.sdk.e2e.create.metric.test", "displayName": "SWO SDK E2E Create Metric Test", "description": "SWO SDK composite metric end to end create test", "formula": "rate(system.disk.io[1m])", "units": "bytes/s"}
        successCriteria:
          - condition: $statusCode == 201
          - condition: $response.header.Content-Type == application/json
          - condition: $response.body#/name == "composite.swo.sdk.e2e.create.metric.test"
          - condition: $response.body#/displayName == "SWO SDK E2E Create Metric Test"
          - condition: $response.body#/description == "SWO SDK composite metric end to end create test"
          - condition: $response.body#/formula == "rate(system.disk.io[1m])"
          - condition: $response.body#/units == "bytes/s"
        outputs:
          name: $response.body#/name
      - stepId: getByName
        description: Retrieve the created metric by name
        operationId: getMetricByName
        dependsOn: create
        parameters:
          - name: name
            in: path
            value: $steps.create.outputs.name
        successCriteria:
          - condition: $statusCode == 200
          - condition: $response.header.Content-Type == application/json
          - condition: $response.body#/name == "composite.swo.sdk.e2e.create.metric.test"
          - condition: $response.body#/displayName == "SWO SDK E2E Create Metric Test"
          - condition: $response.body#/description == "SWO SDK composite metric end to end create test"
          - condition: $response.body#/formula == "rate(system.disk.io[1m])"
          - condition: $response.body#/units == "bytes/s"
        outputs:
          retrievedMetric: $response.body
      - stepId: update
        description: Update the created composite metric
        operationId: updateCompositeMetric
        dependsOn: getMetricByName
        parameters:
          - name: name
            in: path
            value: $steps.create.outputs.name
        requestBody:
          contentType: application/json
          payload: {"displayName": "SWO SDK E2E Updated Metric Test", "description": "SWO SDK composite metric end to end updated test", "formula": "rate(system.cpu.usage[2m])", "units": "bytes/s"}
        successCriteria:
          - condition: $statusCode == 200
          - condition: $response.header.Content-Type == application/json
          - condition: $response.body#/name == "composite.swo.sdk.e2e.create.metric.test"
          - condition: $response.body#/displayName == "SWO SDK E2E Updated Metric Test"
          - condition: $response.body#/description == "SWO SDK composite metric end to end updated test"
          - condition: $response.body#/formula == "rate(system.cpu.usage[2m])"
          - condition: $response.body#/units == "bytes/s"
        outputs:
          updatedMetric: $response.body
      - stepId: getUpdatedMetric
        description: Retrieve the updated metric to verify changes
        operationId: getMetricByName
        dependsOn: update
        parameters:
          - name: name
            in: path
            value: $steps.create.outputs.name
        successCriteria:
          - condition: $statusCode == 200
          - condition: $response.header.Content-Type == application/json
          - condition: $response.body#/name == "composite.swo.sdk.e2e.create.metric.test"
          - condition: $response.body#/displayName == "SWO SDK E2E Updated Metric Test"
          - condition: $response.body#/description == "SWO SDK composite metric end to end updated test"
          - condition: $response.body#/formula == "rate(system.cpu.usage[2m])"
          - condition: $response.body#/units == "bytes/s"
        outputs:
          finalMetric: $response.body
      - stepId: delete
        description: Delete the composite metric
        operationId: deleteCompositeMetric
        dependsOn: getUpdatedMetric
        parameters:
          - name: name
            in: path
            value: $steps.create.outputs.name
        successCriteria:
          - condition: $statusCode == 204
  # /v1/logs - Search logs operation
  - workflowId: logsSearch
    steps:
      - stepId: search
        description: Search logs with basic parameters
        operationId: searchLogs
        parameters:
          - name: filter
            in: query
            value: "level:info"
          - name: direction
            in: query
            value: "backward"
          - name: pageSize
            in: query
            value: 10
          - name: startTime
            in: query
            value: __QUERY_START_TIME__
          - name: endTime
            in: query
            value: __QUERY_END_TIME__
        successCriteria:
          - condition: $statusCode == 200
          - condition: $response.header.Content-Type == application/json
          - condition: $response.body#/pageInfo != null
  # /v1/logs - List log archives operation
  - workflowId: logsArchives
    steps:
      - stepId: list
        description: List log archives with parameters
        operationId: listLogArchives
        parameters:
          - name: pageSize
            in: query
            value: 10
          - name: startTime
            in: query
            value: __QUERY_START_TIME__
          - name: endTime
            in: query
            value: __QUERY_END_TIME__
        successCriteria:
          - condition: $statusCode == 200
          - condition: $response.header.Content-Type == application/json
          - condition: $response.body#/pageInfo != null
          - condition: $response.body#/logArchives != null
  # /v1/tokens - Create token operation
  - workflowId: tokens
    steps:
      - stepId: create
        operationId: createToken
        requestBody:
          contentType: application/json
          payload:
            name: "swo-sdk-e2e-test-token"
            tags:
              server: "swo-sdk-e2e-test-server"
              tag_without_value: "swo-sdk-e2e-test-tag"
            type: ingestion
        successCriteria:
          - condition: $statusCode == 201
          - condition: $response.header.Content-Type == application/json
          - condition: $response.body#/token != null
  - workflowId: createTransaction
    steps:
      - stepId: test
        operationId: createTransaction
        requestBody:
          contentType: application/json
          payload:
            description: Opens Solarwinds homepage
            name: Solarwinds
            tags:
              - key: environment
                value: production
            testDefinition:
              commands:
                - command: OPEN
                  target: https://example.com
              outageConfiguration:
                consecutiveForDown: 2
                failingTestLocations: all
              platformOptions:
                probePlatforms:
                  - AWS
                testFromAll: true
              testFrom:
                type: REGION
                values:
                  - NA
              testIntervalInSeconds: 14400
              windowSize:
                height: 156492
                width: 28965
        successCriteria:
          - condition: $statusCode == 201
          - condition: $response.header.Content-Type == application/json
          - context: $response.body
            condition: |
              {
                "id": "e-1448474379026206720"
              }
            type: simple
    x-speakeasy-test-group: dem
    x-speakeasy-test-rebuild: true
  - workflowId: getTransaction
    steps:
      - stepId: test
        operationId: getTransaction
        parameters:
          - name: entityId
            in: path
            value: <id>
        successCriteria:
          - condition: $statusCode == 200
          - condition: $response.header.Content-Type == application/json
          - context: $response.body
            condition: |
              {
                "id": "e-1448474379026206720",
                "type": "SyntheticTransaction",
                "status": "up",
                "name": "\u003cvalue\u003e",
                "testDefinition": {
                  "testFrom": {
                    "type": "REGION",
                    "values": [
                      "NA"
                    ]
                  },
                  "platformOptions": {
                    "probePlatforms": [
                      "AWS"
                    ],
                    "testFromAll": true
                  },
                  "outageConfiguration": {
                    "failingTestLocations": "all",
                    "consecutiveForDown": 2
                  },
                  "testIntervalInSeconds": 14400,
                  "windowSize": {
                    "width": 806070,
                    "height": 380201
                  },
                  "commands": [
                    {
                      "command": "OPEN",
                      "target": "https://example.com"
                    }
                  ]
                },
                "tags": [
                  {
                    "key": "environment",
                    "value": "production"
                  }
                ],
                "lastOutageStartTime": "2025-01-15T14:31:19.735Z",
                "lastOutageEndTime": "2025-01-15T14:31:19.735Z",
                "lastTestTime": "2025-01-15T14:31:19.735Z",
                "lastErrorTime": "2025-01-15T14:31:19.735Z"
              }
            type: simple
    x-speakeasy-test-group: dem
    x-speakeasy-test-rebuild: true
  - workflowId: updateTransaction
    steps:
      - stepId: test
        operationId: updateTransaction
        parameters:
          - name: entityId
            in: path
            value: <id>
        requestBody:
          contentType: application/json
          payload:
            description: Opens Solarwinds homepage
            name: Solarwinds
            tags:
              - key: environment
                value: production
            testDefinition:
              commands:
                - command: OPEN
                  target: https://example.com
              outageConfiguration: null
              platformOptions:
                probePlatforms:
                  - AWS
                testFromAll: true
              testFrom:
                type: REGION
                values:
                  - NA
              testIntervalInSeconds: 14400
              windowSize:
                height: 72607
                width: 750299
        successCriteria:
          - condition: $statusCode == 200
          - condition: $response.header.Content-Type == application/json
          - context: $response.body
            condition: |
              {
                "id": "e-1448474379026206720"
              }
            type: simple
    x-speakeasy-test-group: dem
    x-speakeasy-test-rebuild: true
  - workflowId: deleteTransaction
    steps:
      - stepId: test
        operationId: deleteTransaction
        parameters:
          - name: entityId
            in: path
            value: <id>
        successCriteria:
          - condition: $statusCode == 200
          - condition: $response.header.Content-Type == application/json
          - context: $response.body
            condition: |
              {
                "id": "e-1448474379026206720"
              }
            type: simple
    x-speakeasy-test-group: dem
    x-speakeasy-test-rebuild: true
  - workflowId: pauseTransactionMonitoring
    steps:
      - stepId: test
        operationId: pauseTransactionMonitoring
        parameters:
          - name: entityId
            in: path
            value: <id>
        successCriteria:
          - condition: $statusCode == 200
          - condition: $response.header.Content-Type == application/json
          - context: $response.body
            condition: |
              {
                "id": "e-1448474379026206720"
              }
            type: simple
    x-speakeasy-test-group: dem
    x-speakeasy-test-rebuild: true
  - workflowId: unpauseTransactionMonitoring
    steps:
      - stepId: test
        operationId: unpauseTransactionMonitoring
        parameters:
          - name: entityId
            in: path
            value: <id>
        successCriteria:
          - condition: $statusCode == 200
          - condition: $response.header.Content-Type == application/json
          - context: $response.body
            condition: |
              {
                "id": "e-1448474379026206720"
              }
            type: simple
    x-speakeasy-test-group: dem
    x-speakeasy-test-rebuild: true
